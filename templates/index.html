<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 손길 - 건강 관리 시스템</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
</head>
<body>
    <div class="container">
        <header class="main-header">
            <div class="header-content">
                <h1 class="logo">AI 손길</h1>
                <p class="subtitle">건강 데이터 실시간 모니터링 및 이상 감지 시스템</p>
            </div>
            <nav class="main-nav">
                <a href="/" class="nav-link active">홈</a>
                <a href="/upload" class="nav-link">건강 데이터 업로드</a>
                <a href="/history" class="nav-link">내 데이터 조회</a>
            </nav>
        </header>

        <main>
            <!-- 환영 메시지 및 건강 상태 요약 -->
            <section class="welcome-section" id="welcome-section" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 16px; margin-bottom: 30px; text-align: center;">
                <h2 style="font-size: 1.8em; margin-bottom: 15px; font-weight: 600;">안녕하세요! 오늘도 건강한 하루 되세요 🌟</h2>
                <p style="font-size: 1.1em; margin-bottom: 25px; opacity: 0.95;">혼자 계셔도 걱정 마세요. 저희가 24시간 건강 상태를 모니터링하고 있습니다.</p>
                
                <!-- 오늘의 건강 상태 요약 (사용자 ID 입력 후 표시) -->
                <div id="today-health-summary" style="display: none; margin-top: 25px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;">
                        <div class="health-summary-card" style="background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(10px); padding: 20px; border-radius: 12px;">
                            <div style="font-size: 2em; margin-bottom: 10px;">📊</div>
                            <div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 5px;">오늘의 건강 점수</div>
                            <div id="today-health-score" style="font-size: 1.8em; font-weight: 700;">-</div>
                        </div>
                        <div class="health-summary-card" style="background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(10px); padding: 20px; border-radius: 12px;">
                            <div style="font-size: 2em; margin-bottom: 10px;">✅</div>
                            <div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 5px;">오늘 체크 완료</div>
                            <div id="today-check-status" style="font-size: 1.3em; font-weight: 600;">미완료</div>
                        </div>
                        <div class="health-summary-card" style="background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(10px); padding: 20px; border-radius: 12px;">
                            <div style="font-size: 2em; margin-bottom: 10px;">🔔</div>
                            <div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 5px;">보호자 연락망</div>
                            <div id="emergency-contacts-count" style="font-size: 1.3em; font-weight: 600;">0명</div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- 오늘의 건강 체크 (간편 버전) -->
            <section class="quick-check-section" id="quick-check-section" style="background: #f8f9fa; padding: 25px; border-radius: 16px; margin-bottom: 30px; display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 class="section-title" style="margin: 0;">
                        <span class="icon">✨</span>
                        오늘의 건강 체크
                    </h2>
                    <button onclick="quickHealthCheck()" class="btn-primary" style="padding: 12px 24px; font-size: 16px;">
                        <span style="margin-right: 8px;">💚</span>
                        빠른 건강 체크하기
                    </button>
                </div>
                <p style="color: #666; margin-bottom: 15px;">간단하게 오늘의 건강 상태를 체크하고 저장하세요. 보호자에게도 자동으로 알림이 전송됩니다.</p>
                <div id="quick-check-result" style="margin-top: 15px;"></div>
            </section>
            <!-- 사용자 정보 섹션 -->
            <section class="user-section">
                <h2 class="section-title">
                    <span class="icon">👤</span>
                    사용자 정보
                </h2>
                <div class="user-input-group" style="display: flex; align-items: flex-start; gap: 15px; flex-wrap: nowrap;">
                    <div class="input-wrapper" style="flex: 1; min-width: 0;">
                        <label for="user-id">사용자 ID <span class="required">*</span></label>
                        <input type="text" id="user-id" placeholder="사용자 ID를 입력하세요" value="" oninput="validateUserId()" onkeypress="handleUserIdKeyPress(event)" style="width: 100%;">
                        <div id="user-id-status" class="input-status"></div>
                    </div>
                    <div style="display: flex; flex-direction: column; justify-content: flex-start; padding-top: 35px;">
                        <button onclick="loadUserData()" class="btn-primary btn-icon" id="load-data-btn" disabled style="white-space: nowrap; padding: 12px 24px;">
                            <span>🔍</span>
                            데이터 조회
                        </button>
                    </div>
                </div>
                <div id="user-stats" class="stats-container"></div>
            </section>


            <!-- 센서 데이터 입력 섹션 -->
            <section class="input-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h2 class="section-title" style="margin: 0;">
                        <span class="icon">📊</span>
                        건강 데이터 입력
                    </h2>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="showHelpModal()" class="btn-secondary btn-small" style="padding: 8px 16px;">
                            <span>❓</span> 도움말
                        </button>
                        <button onclick="callEmergency()" class="btn-secondary btn-small" style="padding: 8px 16px; background: #ef4444; color: white; border: none;">
                            <span>🚨</span> 응급 연락
                        </button>
                    </div>
                </div>
                <p class="section-description" style="background: #e8f5e9; padding: 15px; border-radius: 8px; border-left: 4px solid #4caf50;">
                    💡 <strong>하루에 한 번만 입력하시면 됩니다.</strong> 심박수, 걸음수, 수면 시간, 체온을 입력하시면 자동으로 건강 상태를 분석하고 보호자에게도 알림이 전송됩니다.
                </p>
                <div class="sensor-input-grid">
                    <div class="sensor-input-card">
                        <div class="sensor-icon">❤️</div>
                        <label for="heart-rate">심박수</label>
                        <input type="number" id="heart-rate" placeholder="0" value="0" min="0">
                        <span class="sensor-unit">bpm</span>
                    </div>
                    <div class="sensor-input-card">
                        <div class="sensor-icon">👣</div>
                        <label for="steps">걸음수</label>
                        <input type="number" id="steps" placeholder="0" value="0" min="0">
                        <span class="sensor-unit">걸음</span>
                    </div>
                    <div class="sensor-input-card">
                        <div class="sensor-icon">😴</div>
                        <label for="sleep">수면 시간</label>
                        <input type="number" id="sleep" placeholder="0" step="0.1" value="0" min="0">
                        <span class="sensor-unit">시간</span>
                    </div>
                    <div class="sensor-input-card">
                        <div class="sensor-icon">🌡️</div>
                        <label for="temperature">체온</label>
                        <input type="number" id="temperature" placeholder="0" step="0.1" value="0" min="0">
                        <span class="sensor-unit">℃</span>
                    </div>
                </div>
                <div class="sensor-action-buttons">
                    <button onclick="saveData()" class="btn-primary btn-large" style="flex: 1; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        <span class="btn-icon">💚</span>
                        오늘의 건강 체크 완료
                    </button>
                    <button onclick="predictAnomaly()" class="btn-secondary btn-large" style="flex: 1;">
                        <span class="btn-icon">🔍</span>
                        건강 상태 분석만 보기
                    </button>
                </div>
                <div id="quick-check-action-section" style="margin-top: 20px; padding: 20px; background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-radius: 12px; border: 2px solid #0ea5e9; display: none;">
                    <div style="text-align: center; margin-bottom: 15px;">
                        <h3 style="margin: 0 0 10px 0; color: #0c4a6e; font-size: 18px; font-weight: 600;">
                            ✨ 빠른 건강 체크
                        </h3>
                        <p style="margin: 0; color: #666; font-size: 14px;">
                            현재 입력된 데이터로 바로 건강 체크를 진행하시겠습니까?
                        </p>
                    </div>
                    <button onclick="performQuickHealthCheck()" class="btn-primary btn-large" style="width: 100%; padding: 15px; font-size: 16px; background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);">
                        <span style="margin-right: 8px;">💚</span>
                        빠른 건강 체크 실행
                    </button>
                </div>
                <p style="text-align: center; color: #666; margin-top: 15px; font-size: 0.9em;">
                    💡 "오늘의 건강 체크 완료" 버튼을 누르시면 자동으로 분석하고 저장되며, 보호자에게도 알림이 전송됩니다.
                </p>
            </section>

            <!-- 알림 설정 섹션 -->
            <section class="notification-section">
                <h2 class="section-title">
                    <span class="icon">🔔</span>
                    알림 및 보호자 연락망 설정
                </h2>
                <p class="section-description" style="background: #fff3cd; padding: 15px; border-radius: 8px; border-left: 4px solid #ffc107;">
                    🛡️ <strong>안전을 위한 설정입니다.</strong> 이상 징후가 감지되면 자동으로 알림을 받고, 심각한 경우 보호자에게도 연락이 갑니다. 처음 한 번만 설정하시면 됩니다.
                </p>
                <div class="email-form">
                    <div class="input-wrapper">
                        <label for="notification-email">이메일 주소</label>
                        <div class="email-input-group">
                            <input type="email" id="notification-email" placeholder="이메일 주소를 입력해주세요">
                            <button id="edit-email-btn" onclick="editNotificationEmail()" class="btn-secondary btn-small" style="display: none;">편집</button>
                        </div>
                    </div>
                    <div class="email-actions">
                        <button id="save-email-btn" onclick="saveNotificationEmail()" class="btn-primary">이메일 주소 저장</button>
                        <span id="notification-save-status" class="status-message"></span>
                    </div>
                </div>
                
                <!-- 긴급 연락망 설정 -->
                <div class="emergency-contacts-section" style="margin-top: 30px; padding-top: 30px; border-top: 1px solid #e0e0e0;">
                    <h3 class="subsection-title">
                        <span class="icon">🚨</span>
                        긴급 연락망 설정
                    </h3>
                    <p class="section-description" style="margin-bottom: 20px;">
                        심각한 이상 징후 감지 시 자동으로 알림을 받을 보호자나 가족의 연락처를 등록하세요.
                    </p>
                    
                    <div id="emergency-contacts-list" class="emergency-contacts-list">
                        <!-- 동적으로 추가됨 -->
                    </div>
                    
                    <div class="emergency-contact-form" style="margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                        <h4 style="margin-bottom: 15px; font-size: 16px; font-weight: 600;">새 연락처 추가</h4>
                        <div class="emergency-input-grid" style="display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 10px; align-items: end;">
                            <div class="input-wrapper">
                                <label for="emergency-name">이름</label>
                                <input type="text" id="emergency-name" placeholder="보호자 이름">
                            </div>
                            <div class="input-wrapper">
                                <label for="emergency-email">이메일</label>
                                <input type="email" id="emergency-email" placeholder="이메일 주소">
                            </div>
                            <div class="input-wrapper">
                                <label for="emergency-phone">전화번호 (선택)</label>
                                <input type="tel" id="emergency-phone" placeholder="010-1234-5678">
                            </div>
                            <button onclick="addEmergencyContact()" class="btn-primary">추가</button>
                        </div>
                    </div>
                    
                    <div class="emergency-actions" style="margin-top: 15px;">
                        <button onclick="saveEmergencyContacts()" class="btn-primary">긴급 연락망 저장</button>
                        <span id="emergency-save-status" class="status-message"></span>
                    </div>
                </div>
            </section>

            <!-- 챗봇 섹션 -->
            <section class="chatbot-section">
                <h2 class="section-title">
                    <span class="icon">💬</span>
                    건강 상담 챗봇
                </h2>
                <p class="section-description" style="margin-bottom: 20px; color: #666;">
                    건강에 대해 궁금한 점이 있으시면 언제든지 물어보세요. 친절하게 답변해드립니다.
                </p>
                <div id="notification-banner" class="notification-banner" style="display: none;">
                    <div class="notification-content">
                        <div class="notification-text">
                            <strong class="notification-title">🔔 건강 상태 체크 알림</strong>
                            <p id="notification-message" class="notification-message"></p>
                        </div>
                        <button id="notification-close-btn" onclick="closeNotification()" class="notification-close">&times;</button>
                    </div>
                </div>
                <div class="chat-container">
                    <div id="chat-messages" class="chat-messages"></div>
                    <div class="chat-input">
                        <input type="text" id="chat-input" placeholder="건강 관련 질문을 입력하세요..." onkeypress="handleChatKeyPress(event)">
                        <button onclick="sendChatMessage()">전송</button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>

